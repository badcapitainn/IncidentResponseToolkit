<!-- toolkit/templates/toolkit/report_pdf_template.html -->
{% load percentage_filters %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ report.title }}</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        color: #333;
        line-height: 1.6;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #eee;
        padding-bottom: 20px;
      }
      .header h1 {
        color: #2c3e50;
        margin-bottom: 10px;
      }
      .header .subtitle {
        color: #7f8c8d;
        font-size: 18px;
      }
      .report-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
      }
      .report-info div {
        flex: 1;
      }
      .stat-card {
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        color: white;
        text-align: center;
      }
      .stat-card h3 {
        margin-top: 0;
        font-size: 16px;
      }
      .stat-card .value {
        font-size: 28px;
        font-weight: bold;
        margin: 10px 0;
      }
      .section {
        margin-bottom: 30px;
        page-break-inside: avoid;
      }
      .section-title {
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 15px;
        color: #2c3e50;
      }
      .chart-container {
        height: 300px;
        margin-bottom: 20px;
      }
      .table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      .table th,
      .table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      .table th {
        background-color: #f2f2f2;
      }
      .badge {
        display: inline-block;
        padding: 3px 7px;
        font-size: 12px;
        font-weight: bold;
        line-height: 1;
        color: white;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        border-radius: 10px;
      }
      .severity-critical {
        background-color: #dc3545;
      }
      .severity-high {
        background-color: #fd7e14;
      }
      .severity-medium {
        background-color: #ffc107;
        color: #212529;
      }
      .severity-low {
        background-color: #6c757d;
      }
      .recommendation {
        margin-bottom: 15px;
        padding: 10px;
        border-left: 4px solid #eee;
      }
      .recommendation.critical {
        border-left-color: #dc3545;
        background-color: rgba(220, 53, 69, 0.05);
      }
      .recommendation.high {
        border-left-color: #fd7e14;
        background-color: rgba(253, 126, 20, 0.05);
      }
      .footer {
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        font-size: 12px;
        color: #7f8c8d;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>{{ report.title }}</h1>
      <div class="subtitle">{{ report.get_report_type_display }} Report</div>
    </div>

    <div class="report-info">
      <div>
        <strong>Generated By:</strong> {{ report.generated_by.username }}<br />
        <strong>Generated On:</strong> {{ report.generated_at|date:"M d, Y H:i"
        }}
      </div>
      <div>
        <strong>Date Range:</strong> {{ report.start_date|date:"M d, Y" }} - {{
        report.end_date|date:"M d, Y" }}<br />
        <strong>Report ID:</strong> {{ report.id }}
      </div>
    </div>

    {% if report.report_type == 'THREAT_SUMMARY' %}
    <!-- Threat Summary PDF Content -->
    <div class="section">
      <h2 class="section-title">Key Statistics</h2>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 20px;
        "
      >
        <div
          class="stat-card"
          style="background-color: #2c3e50; flex: 1; margin-right: 10px"
        >
          <h3>Total Threats Detected</h3>
          <div class="value">
            {{
            report.data.malware.malicious_count|add:report.data.network.total_alerts|add:report.data.logs.total_alerts
            }}
          </div>
        </div>
        <div
          class="stat-card"
          style="background-color: #27ae60; flex: 1; margin-right: 10px"
        >
          <h3>Malware Detected</h3>
          <div class="value">{{ report.data.malware.malicious_count }}</div>
        </div>
        <div class="stat-card" style="background-color: #e74c3c; flex: 1">
          <h3>Network Alerts</h3>
          <div class="value">{{ report.data.network.total_alerts }}</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Malware Detection</h2>
      <p>Total scans performed: {{ report.data.malware.total_scans }}</p>
      <p>Malicious files detected: {{ report.data.malware.malicious_count }}</p>

      <h3>Malware by Type</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Malware Type</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.malware.by_type %}
          <tr>
            <td>{{ item.malware_type|default:"Unknown" }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2 class="section-title">Network Alerts</h2>
      <p>Total alerts triggered: {{ report.data.network.total_alerts }}</p>

      <h3>Alerts by Severity</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Severity</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.network.by_severity %}
          <tr>
            <td>{{ item.severity|title }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Top Source IPs</h3>
      <table class="table">
        <thead>
          <tr>
            <th>IP Address</th>
            <th>Alert Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.network.top_src_ips %}
          <tr>
            <td>{{ item.src_ip }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2 class="section-title">Log Alerts</h2>
      <p>Total log alerts: {{ report.data.logs.total_alerts }}</p>
      <p>
        Resolved alerts: {{ report.data.logs.resolved_rate.resolved }} ({{
        report.data.logs.resolved_rate.resolved|percentage:report.data.logs.total_alerts
        }})
      </p>

      <h3>Alerts by Level</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Level</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.logs.by_level %}
          <tr>
            <td>{{ item.level }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2 class="section-title">Recent Security Activities</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Activity</th>
            <th>Module</th>
          </tr>
        </thead>
        <tbody>
          {% for activity in report.data.activities %}
          <tr>
            <td>{{ activity.timestamp|date:"M d, H:i" }}</td>
            <td>{{ activity.activity }}</td>
            <td>{{ activity.module }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% elif report.report_type == 'THREAT_INTEL' %}
    <!-- Threat Intelligence PDF Content -->
    <div class="section">
      <h2 class="section-title">Threat Intelligence Overview</h2>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 20px;
        "
      >
        <div
          class="stat-card"
          style="background-color: #e74c3c; flex: 1; margin-right: 10px"
        >
          <h3>Malware Variants</h3>
          <div class="value">
            {{ report.data.malware_intel.emerging_threats|length }}
          </div>
        </div>
        <div
          class="stat-card"
          style="background-color: #f39c12; flex: 1; margin-right: 10px"
        >
          <h3>Critical Alerts</h3>
          <div class="value">
            {{ report.data.network_intel.critical_alerts|length }}
          </div>
        </div>
        <div class="stat-card" style="background-color: #3498db; flex: 1">
          <h3>Threat Correlations</h3>
          <div class="value">{{ report.data.threat_correlation|length }}</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Malware Intelligence</h2>

      <h3>Emerging Threat Types</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Malware Type</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.malware_intel.emerging_threats %}
          <tr>
            <td>{{ item.malware_type|default:"Unknown" }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Recent Malware Detections</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>File Path</th>
            <th>Malware Type</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for malware in report.data.malware_intel.recent_malware %}
          <tr>
            <td>{{ malware.scan_time|date:"M d, H:i" }}</td>
            <td>{{ malware.file_path|truncatechars:30 }}</td>
            <td>
              <span class="badge severity-critical"
                >{{ malware.malware_type }}</span
              >
            </td>
            <td>{{ malware.details|truncatechars:50 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2 class="section-title">Network Intelligence</h2>

      <h3>Common Attack Patterns</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Rule Name</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.network_intel.common_attack_patterns %}
          <tr>
            <td>{{ item.rule_name }}</td>
            <td>{{ item.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Critical Network Alerts</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Rule</th>
            <th>Source → Destination</th>
            <th>Protocol</th>
          </tr>
        </thead>
        <tbody>
          {% for alert in report.data.network_intel.critical_alerts %}
          <tr>
            <td>{{ alert.timestamp|date:"M d, H:i" }}</td>
            <td>{{ alert.rule_name }}</td>
            <td>{{ alert.src_ip }} → {{ alert.dst_ip }}</td>
            <td>{{ alert.protocol }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2 class="section-title">Threat Correlation</h2>
      <p>
        Number of correlated threats: {{ report.data.threat_correlation|length
        }}
      </p>

      <table class="table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Alert ID</th>
            <th>Malware File</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.threat_correlation %}
          <tr>
            <td>{{ item.timestamp|date:"M d, H:i" }}</td>
            <td>{{ item.alert_id }}</td>
            <td>{{ item.malware_file|truncatechars:40 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% elif report.report_type == 'SYSTEM_SAFETY' %}
    <!-- System Safety PDF Content -->
    <div class="section">
      <h2 class="section-title">System Health Overview</h2>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 20px;
        "
      >
        <div
          class="stat-card"
          style="background-color: #3498db; flex: 1; margin-right: 10px"
        >
          <h3>System Health Score</h3>
          <div class="value">
            {% widthratio 100 report.data.system_health.error_rate
            report.data.system_health.log_volume as health_score %} {{
            health_score|floatformat:0 }}%
          </div>
        </div>
        <div
          class="stat-card"
          style="background-color: #27ae60; flex: 1; margin-right: 10px"
        >
          <h3>Protected Assets</h3>
          <div class="value">
            {{ report.data.protection_status.malware_detection_rate }}
          </div>
        </div>
        <div class="stat-card" style="background-color: #2c3e50; flex: 1">
          <h3>Network Sessions</h3>
          <div class="value">
            {{ report.data.network_health.capture_sessions }}
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">System Metrics</h2>

      <h3>Log Statistics</h3>
      <p>Total log entries: {{ report.data.system_health.log_volume }}</p>
      <p>
        Error logs: {{ report.data.system_health.error_rate }} ({{
        report.data.system_health.error_rate|percentage:report.data.system_health.log_volume
        }})
      </p>
      <p>
        Compressed logs: {{ report.data.system_health.compression_rate }} ({{
        report.data.system_health.compression_rate|percentage:report.data.system_health.log_volume
        }})
      </p>

      <h3>Log Levels Distribution</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Level</th>
            <th>Count</th>
            <th>Percentage</th>
          </tr>
        </thead>
        <tbody>
          {% for item in report.data.system_health.log_levels %}
          <tr>
            <td>{{ item.level }}</td>
            <td>{{ item.count }}</td>
            <td>{{ item.count|percentage:report.data.system_health.log_volume }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Network Statistics</h3>
      <p>Capture sessions: {{ report.data.network_health.capture_sessions }}</p>
      <p>
        Average packets per session: {{
        report.data.network_health.average_packets|floatformat:0 }}
      </p>
      <p>
        Active capture sessions: {{ report.data.network_health.active_captures
        }}
      </p>
    </div>

    <div class="section">
      <h2 class="section-title">Protection Status</h2>

      <h3>Threat Protection</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Metric</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Malware Detected</td>
            <td>{{ report.data.protection_status.malware_detection_rate }}</td>
          </tr>
          <tr>
            <td>IPs Blocked</td>
            <td>{{ report.data.protection_status.blocked_threats }}</td>
          </tr>
          <tr>
            <td>Files Quarantined</td>
            <td>{{ report.data.protection_status.quarantine_success }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    {% if report.data.recommendations %}
    <div class="section">
      <h2 class="section-title">Security Recommendations</h2>

      {% for rec in report.data.recommendations %}
      <div class="recommendation {{ rec.severity }}">
        <h3>{{ rec.category }}</h3>
        <p>{{ rec.message }}</p>
        <p>
          <strong>Severity:</strong>
          <span class="badge severity-{{ rec.severity }}"
            >{{ rec.severity|upper }}</span
          >
        </p>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endif %}

    <div class="footer">
      <p>
        Generated by IRAT Toolkit on {{ report.generated_at|date:"M d, Y H:i" }}
      </p>
      <p>Confidential - For authorized personnel only</p>
    </div>
  </body>
</html>
